<!-- wp:html -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/css/ol.css" type="text/css">
    <style>
      .map {
        height: 700px;
        width: 100%;
      }
      .map .ol-zoom {
      top: 20px;
      left: 5px;
      }
      .map:-webkit-full-screen {
      height: 100%;
      margin: 0;
      }
      .ol-scale-line {
      height: 10px;
      bottom: 20px;
      }
      .map .ol-rotate {
      top: 3em;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.5.0/build/ol.js"></script>
    <title>OpenLayers example</title>
  
  
    <h2>Bouys</h2>
    <input type="checkbox" id="buoy1" checked=""> Buoy One <br>
        <il>
            <input type="checkbox" id="buoy1Path"> Path Visible<br>
        </il>
    <input type="checkbox" id="buoy2" checked=""> Buoy Two <br>
        <il>
            <input type="checkbox" id="buoy2Path"> Path Visible<br>
        </il>

    <div class="overlay-container">
        <span class="overlay-text" id="Feature-Temperature"></span><br>
        <span class="overlay-text" id="Feature-Pressure"></span><br>
        <span class="overlay-text" id="Feature-Time"></span><br>
    </div>
    <h2>Bouy Project Visualization</h2>
    <div id="map" class="map"></div>
    <script type="text/javascript">


      var map = new ol.Map({
    controls: ol.control.defaults().extend([new ol.control.FullScreen()]),
    interactions: ol.interaction.defaults({
          shiftDragZoom: false
        }).extend([new ol.interaction.DragRotateAndZoom()]),
    target: 'map',
    layers: [
        new ol.layer.Tile({
            source: new ol.source.OSM()
        }),
    ],
    view: new ol.View({
        center: [0, 0],
        projection: 'EPSG:4326',
        zoom: 0,
        maxZoom: 18
    })

});

    var geojsonObject = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
          "Time": 300434064120490,
          "Temperature": 12.63,
          "Pressure": 68414.94
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -77.373962,
          35.614325
        ]
      }
    }
  ]
}

var geojsonObject1 = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "Temperature": 89,
        "Pressure": 7523,
        "Time": "5'o'clock"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -80.22216796875,
          25.799891182088334
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Temperature": 100,
        "Pressure": 6000,
        "Time": "Test Time"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -66.11572265625,
          18.46918890441719
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "Temperature": 500,
        "Pressure": 9001,
        "Time": "Mon, Jun 14, 2021"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          -64.78431701660156,
          32.29525895520317
        ]
      }
    }
  ]
}

const strokeStyle = new ol.style.Stroke ({
        color: [46, 45, 45, 1],
        width: 1.2
    })

    const circleStyleGreen = new ol.style.Circle({
        fill: new ol.style.Fill({
            color: 'green'
        }),
        radius: 7,
        stroke: strokeStyle
    })

    const circleStyleRed = new ol.style.Circle({
        fill: new ol.style.Fill({
            color: 'red'
        }),
        radius: 7,
        stroke: strokeStyle
    })

const buoy1 = new ol.layer.Vector({
        source: new ol.source.Vector({
            url: 'http://38.123.149.95/wp-content/uploads/buoy-data/300434064121410.json',
            format: new ol.format.GeoJSON()
        }),
        visible: true,
        title: 'Test Bouy',
        style: new ol.style.Style({
            stroke: strokeStyle,
            image: circleStyleGreen
        })
    })


const buoy2 = new ol.layer.Vector({
        source: new ol.source.Vector({
            url: 'http://38.123.149.95/wp-content/uploads/buoy-data/300434064122530.json',
            format: new ol.format.GeoJSON()
        }),
        visible: true,
        title: 'Test Bouy',
        style: new ol.style.Style({
            stroke: strokeStyle,
            image: circleStyleRed
        })
    })

map.addLayer(buoy1);
map.addLayer(buoy2);

var scaleLine = new ol.control.ScaleLine({ 
    units: 'us'
 });

map.addControl(scaleLine);

function changeVis() {
    var currentBuoy = this.id;
    if (currentBuoy == "buoy1") {
        buoy1.setVisible(this.checked);
    }
    else if (currentBuoy == "buoy2") {
        buoy2.setVisible(this.checked);
    }
}

const overlayContainerElement = document.querySelector('.overlay-container');
const overlayLayer = new ol.Overlay({
    element: overlayContainerElement
})
map.addOverlay(overlayLayer)
const overlayFeatureTemperature = document.getElementById('Feature-Temperature');
const overlayFeaturePressure = document.getElementById('Feature-Pressure');
const overlayFeatureTime = document.getElementById('Feature-Time');


map.on('click', function(e){
    overlayLayer.setPosition(undefined);
    map.forEachFeatureAtPixel(e.pixel, function(feature, layer){
            
        let clickedCoord = e.coordinate;
        let clickedTemperature = feature.get('Temperature');
        let clickedPressure = feature.get('Pressure');
        let clickedTime = feature.get('Time');
        console.log(clickedCoord);
        overlayLayer.setPosition(clickedCoord);
        overlayFeatureTemperature.innerHTML = clickedTemperature;
        overlayFeaturePressure.innerHTML = clickedPressure;
        overlayFeatureTime.innerHTML = clickedTime;
    })
})

document.getElementById("buoy1").addEventListener("change", changeVis);
document.getElementById("buoy2").addEventListener("change", changeVis);

var styleArrow = function (feature) {
    var geometry = feature.getGeometry();
    var styles = [
        // linestring
        new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: 'green',
                width: 2,
            }),
        })];

    geometry.forEachSegment(function (start, end) {
        var dx = end[0] - start[0];
        var dy = end[1] - start[1];
        var rotation = Math.atan2(dy, dx);
        // arrows
        styles.push(
            new ol.style.Style({
                geometry: new ol.geom.Point(end),
                image: new ol.style.Icon({
                    color: 'green',
                    src: 'https://openlayers.org/en/latest/examples/data/arrow.png',
                    anchor: [0.75, 0.5],
                    rotateWithView: true,
                    rotation: -rotation,
                    scale: 1,
                }),
            })
        );
    });

    return styles;
};

window.onload = function createPaths() {
    var geojson = []

    buoy1.getSource().forEachFeature(function (feature) {
        var x = feature.getGeometry().getCoordinates()[0];
        var y = feature.getGeometry().getCoordinates()[1];
        geojson.push([x, y]);
    });

    var lineString = { "type": "LineString", "coordinates": geojson }

    var testPath1Source = new ol.source.Vector({
        features: new ol.format.GeoJSON().readFeatures(lineString),
    });

    var buoy1Path = new ol.layer.Vector({
        source: testPath1Source,
        visible: false,
        title: 'Test Path',
        style: styleArrow
    });

    map.addLayer(buoy1Path);


    var geojson = []

    buoy2.getSource().forEachFeature(function (feature) {
        var x = feature.getGeometry().getCoordinates()[0];
        var y = feature.getGeometry().getCoordinates()[1];
        console.log([x, y]);
        geojson.push([x, y]);
    });

    var lineString = { "type": "LineString", "coordinates": geojson }

    var testPath2Source = new ol.source.Vector({
        features: new ol.format.GeoJSON().readFeatures(lineString),
    });

    var buoy2Path = new ol.layer.Vector({
        source: testPath2Source,
        visible: false,
        title: 'Test Path',
        style: styleArrow,
    });

    map.addLayer(buoy2Path);

    function changePathVis() {
        var currentBuoyPath = this.id;
        if (currentBuoyPath == "buoy1Path") {
            buoy1Path.setVisible(this.checked);
        }
        else if (currentBuoyPath == "buoy2Path") {
            buoy2Path.setVisible(this.checked);
        }
    }

    document.getElementById("buoy1Path").addEventListener("change", changePathVis);

    document.getElementById("buoy2Path").addEventListener("change", changePathVis);

}

    </script>
<!-- /wp:html -->
